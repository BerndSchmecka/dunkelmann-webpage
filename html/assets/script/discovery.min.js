/*! *****************************************************************************
Copyright (c) Dunkelmann 2021. All rights reserved.

This code is licensed under the BSD License
You should have received a copy of the BSD License
with this code and it is also available through
the world-wide-web at <https://files.dunkelmann.eu/license.txt>.
If you did not receive a copy of the BSD License
and are unable to obtain it through the world-wide-web,
please send a note to <business@dunkelmann.eu> so we can mail you a copy
immediately.
***************************************************************************** */
let DISCOVERY_ENDPOINT="aHR0cHM6Ly9jb3JzLXByb3h5LmR1bmtlbG1hbm4uZXUvNjg3NDc0NzA3MzNhMmYyZjY0Njk3MzYzNmY3NjY1NzI3OTJlNzQ2NTYxNmQ3MzcwNjU2MTZiMmU2MzZmNmQyZjcxNzU2NTcyNzkyZi8=";decodeBase64=function(e){var t,s,a={},r=65,o=0,n=0,c="",i=String.fromCharCode,u=e.length;for(t="";91>r;)t+=i(r++);for(t+=t.toLowerCase()+"0123456789+/",r=0;64>r;r++)a[t.charAt(r)]=r;for(t=0;t<u;t++)for(o=(o<<6)+(r=a[e.charAt(t)]),n+=6;8<=n;)((s=o>>>(n-=8)&255)||t<u-2)&&(c+=i(s));return c},parseUnixTime=function(e){var t=new Date(1e3*e),s="0"+t.getDate(),a="0"+(t.getMonth()+1),r=t.getFullYear(),o="0"+t.getHours(),n="0"+t.getMinutes(),c="0"+t.getSeconds();return s.substr(-2)+"."+a.substr(-2)+"."+r+" - "+o.substr(-2)+":"+n.substr(-2)+":"+c.substr(-2)};var DiscoveryCards=new Vue({el:"#cardsDiv",data:{cards:[]},created:function(){this.doQuery("*%3A*")},methods:{doQuery:function(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===t.readyState&&200===t.status){var e=JSON.parse(t.responseText);DiscoveryCards.cards=[],e.entries.forEach(e=>{DiscoveryCards.cards.push({name:e.name,topic:e.topic?e.topic:"No description available",people:e.members+("server"===e.type.toLowerCase()?" - "+e.address:""),created:`First seen: ${parseUnixTime(e.created)}`,join:`Join ${e.type.toLowerCase()}`,tooltips:{join:"server"===e.type.toLowerCase()?"Open a connection to this server":`Join this ${e.type.toLowerCase()}`,channel:e.canCreateChannel?"Guests can create channels":"Guests can't create channels",homebase:e.canCreateHomebase?"Guests can use this server as homebase":"Guests can't use this server as homebase"},classes:{channel:`fas fa-plus-square ${e.canCreateChannel?"fa-channel-icon text-primary":"fa-channel-icon"}`,homebase:`fas fa-home ${e.canCreateHomebase?"fa-homebase-icon text-primary":"fa-homebase-icon"}`},isServer:"server"===e.type.toLowerCase()})})}},t.open("GET",decodeBase64(DISCOVERY_ENDPOINT)+"?q="+e+"&start=0&rows=30&sort_by=members&sort_order=desc"),t.send()}}}),control=new Vue({el:"#control_elements",data:{nodeValue:"",filterValue:""},methods:{queryWithFilter:function(){DiscoveryCards.doQuery((this.nodeValue?`%2B*${encodeURIComponent(this.nodeValue)}*`:"*%3A*")+this.filterValue)}},watch:{filterValue:function(){this.queryWithFilter()}}});
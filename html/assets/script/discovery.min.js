/*! *****************************************************************************
Copyright (c) Dunkelmann 2021. All rights reserved.

This code is licensed under the BSD License
You should have received a copy of the BSD License
with this code and it is also available through
the world-wide-web at <https://files.dunkelmann.eu/license.txt>.
If you did not receive a copy of the BSD License
and are unable to obtain it through the world-wide-web,
please send a note to <business@dunkelmann.eu> so we can mail you a copy
immediately.
***************************************************************************** */
let DISCOVERY_ENDPOINT="aHR0cHM6Ly9jb3JzLXByb3h5LmR1bmtlbG1hbm4uZXUvNjg3NDc0NzA3MzNhMmYyZjY0Njk3MzYzNmY3NjY1NzI3OTJlNzQ2NTYxNmQ3MzcwNjU2MTZiMmU2MzZmNmQyZjcxNzU2NTcyNzkyZi8=";decodeBase64=function(e){var s,a,r={},i=65,t=0,n=0,o="",c=String.fromCharCode,d=e.length;for(s="";91>i;)s+=c(i++);for(s+=s.toLowerCase()+"0123456789+/",i=0;64>i;i++)r[s.charAt(i)]=i;for(s=0;s<d;s++)for(t=(t<<6)+(i=r[e.charAt(s)]),n+=6;8<=n;)((a=t>>>(n-=8)&255)||s<d-2)&&(o+=c(a));return o},parseUnixTime=function(e){var s=new Date(1e3*e),a="0"+s.getDate(),r="0"+(s.getMonth()+1),i=s.getFullYear(),t="0"+s.getHours(),n="0"+s.getMinutes(),o="0"+s.getSeconds();return a.substr(-2)+"."+r.substr(-2)+"."+i+" - "+t.substr(-2)+":"+n.substr(-2)+":"+o.substr(-2)},Vue.component("discovery-card",{props:["card"],template:'\n    <div class="col-md-auto">\n    <div class="discovery-object">\n        <div class="discovery-banner" style="background: linear-gradient(180deg, rgba(2,0,36,1) 0%, rgba(39,39,200,1) 33%, rgba(2,117,215,1) 63%, rgba(0,212,255,1) 100%);"></div>\n        <div class="discovery-icon">\n            <span style="background: url(\'assets/discovery/icon_placeholder.png\'); background-size: 64px 64px;"></span>\n        </div>\n        <div class="discovery-name">\n            <div class="discovery-name-text" :title="card.name"> {{ card.name }} </div>\n        </div>\n        <div class="discovery-people">\n            <div class="discovery-people-icon"><i class="fas fa-user fa-discovery-icon"></i></div>\n            <div class="discovery-small-text discovery-people-text"> {{ card.people }} </div>\n        </div>\n        <div class="discovery-desc">\n            <div class="discovery-small-text"> {{ card.topic }} </div>\n        </div>\n        <div class="discovery-created discovery-small-text"> {{ card.created }} </div>\n        <div class="discovery-footer">\n            <div class="discovery-connect">\n                <div class="discovery-small-text discovery-link" :title="card.tooltips.join"> {{ card.join }} </div>\n            </div>\n                <div class="discovery-bookmark" title="Bookmark this server" v-if="card.isServer">\n                    <i class="fas fa-bookmark fa-bookmark-icon"></i>\n                </div>\n                <div class="discovery-channel" :title="card.tooltips.channel" v-if="card.isServer">\n                    <i :class="card.classes.channel"></i>\n                </div>\n                <div class="discovery-homebase" :title="card.tooltips.homebase" v-if="card.isServer">\n                    <i :class="card.classes.homebase"></i>\n                </div>\n        </div>\n    </div>\n</div>\n    '});var app=new Vue({el:"#discoveryApp",data:{cards:[],nodeValue:"",filterValue:""},created:function(){this.doQuery("*%3A*")},methods:{queryWithFilter:function(){app.doQuery((this.nodeValue?`%2B*${encodeURIComponent(this.nodeValue)}*`:"*%3A*")+this.filterValue)},doQuery:function(e){var s=new XMLHttpRequest;s.onreadystatechange=function(){if(4===s.readyState&&200===s.status){var e=JSON.parse(s.responseText);app.cards=[],e.entries.forEach(e=>{app.cards.push({id:e.id,name:e.name,topic:e.topic?e.topic:"No description available",people:e.members+("server"===e.type.toLowerCase()?" - "+e.address:""),created:`First seen: ${parseUnixTime(e.created)}`,join:`Join ${e.type.toLowerCase()}`,tooltips:{join:"server"===e.type.toLowerCase()?"Open a connection to this server":`Join this ${e.type.toLowerCase()}`,channel:e.canCreateChannel?"Guests can create channels":"Guests can't create channels",homebase:e.canCreateHomebase?"Guests can use this server as homebase":"Guests can't use this server as homebase"},classes:{channel:`fas fa-plus-square ${e.canCreateChannel?"fa-channel-icon text-primary":"fa-channel-icon"}`,homebase:`fas fa-home ${e.canCreateHomebase?"fa-homebase-icon text-primary":"fa-homebase-icon"}`},isServer:"server"===e.type.toLowerCase()})})}},s.open("GET",decodeBase64(DISCOVERY_ENDPOINT)+"?q="+e+"&start=0&rows=30&sort_by=members&sort_order=desc"),s.send()}},watch:{filterValue:function(){this.queryWithFilter()}}});
<html>
<head>
<title>Dunkelmann Status</title>
<style>
.embedded-content {
width: 100%;
height: 100%;
border: none;
}
</style>
</head>
<body>
<div id="status_table"><b>Services:</b><br><br>
<table>
<tr>
<th>Service Name</th>
<th>Service ID</th>
<th>Service URL</th>
<th>Service Status</th>
</tr>
<tr id="website">
<td>Homepage</td>
</tr>
<tr id="api">
<td>Dunkelmann-API</td>
</tr>
<tr id="matrix">
<td>Chat-Server (Synapse)</td>
</tr>
<tr id="insomnium">
<td>Chat-Server (Insomnium)</td>
</tr>
<tr id="cloud">
<td>Dunkelmann-Cloud</td>
</tr>
</table>
</div>
<br>
<div id="legend"><b>Legend:</b><br><br>
<img src='assets/circle_green.png' alt='Circle (green)'> 2xx - Success<br>
<img src='assets/circle_orange.png' alt='Circle (orange)'> 3xx - Redirection<br>
<img src='assets/circle_yellow.png' alt='Circle (yellow)'> 4xx - Client Error<br>
<img src='assets/circle_red.png' alt='Circle (red)'> 5xx - Server Error<br>
<img src='assets/circle_blue.png' alt='Circle (blue)'> 6xx - Dunkelmann Error<br>
<img src='assets/circle_grey.png' alt='Circle (grey)'> Other/Unknown<br>
</div>
<br>
<div id="maintenance"><b>Scheduled Maintenances:</b><br><br>
<iframe class="embedded-content" src="https://embed.dunkelmann.eu/events/" title="Maintenances"></iframe>
</div>
<script>

function appendImage(obj, name) {
document.getElementById(obj.id).innerHTML += "<td><img src='assets/circle_"+name+".png' alt='Circle ("+name+")'> "+obj.statusCode+" "+obj.statusDesc+"</td>"
}

var req = new XMLHttpRequest();
req.onreadystatechange = function() {
if(req.readyState === 4 && req.status === 200){
var resp = JSON.parse(req.responseText);

resp.forEach(function(obj) {
document.getElementById(obj.id).innerHTML += "<td>"+obj.id+"</td>"
					  +  "<td>"+obj.url+"</td>";

if(200 <= obj.statusCode && obj.statusCode <= 299){
appendImage(obj, "green");
} else if(300 <= obj.statusCode && obj.statusCode <= 399) {
appendImage(obj, "orange");
} else if(400 <= obj.statusCode && obj.statusCode <= 499) {
appendImage(obj, "yellow");
} else if(500 <= obj.statusCode && obj.statusCode <= 599) {
appendImage(obj, "red");
} else if(600 <= obj.statusCode && obj.statusCode <= 699) {
appendImage(obj, "blue");
} else {
appendImage(obj, "grey");
}

});

} else if (req.readyState === 4) {

}
}
req.open("GET", "https://api.dunkelmann.eu/status");
req.send();
</script>
</body>
</html>
